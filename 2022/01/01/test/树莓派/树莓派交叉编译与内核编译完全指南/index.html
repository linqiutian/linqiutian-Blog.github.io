<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>树莓派交叉编译与内核编译完全指南 | 林秋天的博客</title><meta name="author" content="LinQiuTian"><meta name="copyright" content="LinQiuTian"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#F8F5F0"><meta name="description" content="树莓派交叉编译 &amp; 内核编译 - HQ[TOC]  注意-   树莓派交叉编译引入为什么要交叉编译  因为目的平台上的资源贫乏，无法运行我们所需要编译器，平台上不允许或不能够安装我们所需要的编译器比如C51。  树莓派有时又是因为目的平台还没有建立，连操作系统都没有，根本谈不上运行什么编译器。操作系统也是代码，也要编译。    平台运行需要两样至少东西：bootloader（启动引导代码）">
<meta property="og:type" content="article">
<meta property="og:title" content="树莓派交叉编译与内核编译完全指南">
<meta property="og:url" content="https://www.linqiutianovo.xyz/2022/01/01/test/%E6%A0%91%E8%8E%93%E6%B4%BE/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E4%B8%8E%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/index.html">
<meta property="og:site_name" content="林秋天的博客">
<meta property="og:description" content="树莓派交叉编译 &amp; 内核编译 - HQ[TOC]  注意-   树莓派交叉编译引入为什么要交叉编译  因为目的平台上的资源贫乏，无法运行我们所需要编译器，平台上不允许或不能够安装我们所需要的编译器比如C51。  树莓派有时又是因为目的平台还没有建立，连操作系统都没有，根本谈不上运行什么编译器。操作系统也是代码，也要编译。    平台运行需要两样至少东西：bootloader（启动引导代码）">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.linqiutianovo.xyz/img/default-cover3.jpg">
<meta property="article:published_time" content="2021-12-31T16:00:00.000Z">
<meta property="article:modified_time" content="2025-05-30T06:09:50.481Z">
<meta property="article:author" content="LinQiuTian">
<meta property="article:tag" content="树莓派">
<meta property="article:tag" content="交叉编译">
<meta property="article:tag" content="内核编译">
<meta property="article:tag" content="Linux开发">
<meta property="article:tag" content="嵌入式">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.linqiutianovo.xyz/img/default-cover3.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "树莓派交叉编译与内核编译完全指南",
  "url": "https://www.linqiutianovo.xyz/2022/01/01/test/%E6%A0%91%E8%8E%93%E6%B4%BE/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E4%B8%8E%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/",
  "image": "https://www.linqiutianovo.xyz/img/default-cover3.jpg",
  "datePublished": "2021-12-31T16:00:00.000Z",
  "dateModified": "2025-05-30T06:09:50.481Z",
  "author": [
    {
      "@type": "Person",
      "name": "LinQiuTian",
      "url": "https://www.linqiutianovo.xyz/"
    }
  ]
}</script><link rel="shortcut icon" href="https://www.fomal.cc/favicon.ico"><link rel="canonical" href="https://www.linqiutianovo.xyz/2022/01/01/test/%E6%A0%91%E8%8E%93%E6%B4%BE/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E4%B8%8E%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.4.0-b1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#F8F5F0')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const hour = new Date().getHours()
          const isNight = hour <= 6 || hour >= 18
          if (theme === undefined) isNight ? activateDarkMode() : activateLightMode()
          else theme === 'light' ? activateLightMode() : activateDarkMode()
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '树莓派交叉编译与内核编译完全指南',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/universe.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/url(https:/s2.loli.net/2024/08/07/EBzp91lhZCgXDI6.png));"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2024/08/07/KfPnTIM8WvotugL.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">31</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa-heart"></i><span> 留言板</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/default-cover3.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">林秋天的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">树莓派交叉编译与内核编译完全指南</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa-heart"></i><span> 留言板</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">树莓派交叉编译与内核编译完全指南</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-12-31T16:00:00.000Z" title="发表于 2022-01-01 00:00:00">2022-01-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-05-30T06:09:50.481Z" title="更新于 2025-05-30 14:09:50">2025-05-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A0%91%E8%8E%93%E6%B4%BE/">树莓派</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A0%91%E8%8E%93%E6%B4%BE/Linux%E5%BC%80%E5%8F%91/">Linux开发</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">5.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>21分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2025-05-30 14:09:50&quot;}" hidden></div><h1 id="树莓派交叉编译-内核编译-HQ"><a href="#树莓派交叉编译-内核编译-HQ" class="headerlink" title="树莓派交叉编译 &amp; 内核编译 - HQ"></a>树莓派交叉编译 &amp; 内核编译 - HQ</h1><p>[TOC]</p>
<hr>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>- </p>
<hr>
<h1 id="树莓派交叉编译"><a href="#树莓派交叉编译" class="headerlink" title="树莓派交叉编译"></a>树莓派交叉编译</h1><h3 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h3><p><strong>为什么要交叉编译</strong></p>
<ol>
<li><p>因为目的平台上的资源贫乏，无法运行我们所需要编译器，平台上不允许或不能够安装我们所需要的编译器比如C51。</p>
</li>
<li><p>树莓派有时又是因为目的平台还没有建立，连操作系统都没有，根本谈不上运行什么编译器。操作系统也是代码，也要编译。</p>
</li>
</ol>
<blockquote>
<p>平台运行需要两样至少东西：bootloader（启动引导代码）以及操作系统核心</p>
<p>宿主机（host） ：编辑和编译程序的平台，一般是基于X86的PC机，通常也被称为主机。</p>
<p>目标机（target）：用户开发的系统，通常都是非X86平台。host编译得到的可执行代码在target上运行。</p>
</blockquote>
<p><strong>交叉编译需要用到什么工具</strong></p>
<p>交叉编译器、交叉编译工具链</p>
<h3 id="交叉编译工具链的安装"><a href="#交叉编译工具链的安装" class="headerlink" title="交叉编译工具链的安装"></a>交叉编译工具链的安装</h3><p><a target="_blank" rel="noopener" href="https://github.com/raspberrypi/">https://github.com/raspberrypi/</a></p>
<ol>
<li>从共享文件夹拷贝到工作目录  <code>cp /mnt/hgfs/share/tools-master.zip .</code></li>
<li>解压  <code>unzip tools-master.zip</code></li>
<li>&#96;&#96;cd &#x2F;home&#x2F;CLC&#x2F;lessonPI&#x2F;tools-master&#x2F;arm-bcm2708&#x2F;gcc-linaro-arm-linux-gnueabihf-raspbian-x64&#x2F;bin&#96;</li>
<li><code>pwd</code>获得路径</li>
<li><code>echo $PATH</code> 获得当前环境变量的值</li>
</ol>
<p><strong>临时有效，配置环境变量</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PATH 环境变量</span><br><span class="line"></span><br><span class="line">export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/home/CLC/lessonPI/tools-master/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin</span><br></pre></td></tr></table></figure>

<p><strong>永久有效，配置环境变量</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">修改工作目录下的.bashrc 隐藏文件，配置命令终端的  vi /home/CLC/.bashrc</span><br><span class="line"></span><br><span class="line">在文件最后一行加入：</span><br><span class="line"></span><br><span class="line">export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/home/CLC/lessonPI/tools-master/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin</span><br><span class="line"></span><br><span class="line">source /home/CLC/.bashrc 加载配置文件，马上生效配置。</span><br></pre></td></tr></table></figure>

<blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../../../images/bf23abb9335c7529fe25d8eb3ffa5024-42710-1748585374057-1" alt="img"></p>
</blockquote>
<p>将安装路径添加到PATH中，添加到.bashrc的结尾即可</p>
<blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../../../images/a3538b7515fa89f7810eff02416638ae-62196-1748585374057-2" alt="img"></p>
</blockquote>
<blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../../../images/6c7d0cf21d41865a112762b2a5de831e-9882-1748585374057-3" alt="img"></p>
</blockquote>
<h3 id="交叉编译使用举例"><a href="#交叉编译使用举例" class="headerlink" title="交叉编译使用举例"></a>交叉编译使用举例</h3><p>交叉编译：检查下交叉编译工具对不对 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arm-linux-gnueabihf-gcc -v    4.8.3  </span><br><span class="line">arm-linux-gnueabihf-gcc xxx.c -o xxx</span><br></pre></td></tr></table></figure>

<p>如何把编译生成的可执行文件下载到开发板  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 指令 文件名 开发板用户名@开发板地址：开发板的绝对路径</span><br><span class="line">scp clientInPi pi@192.168.43.30:/home/pi</span><br></pre></td></tr></table></figure>





<h1 id="树莓派源码分析-内核编译-简略"><a href="#树莓派源码分析-内核编译-简略" class="headerlink" title="树莓派源码分析 &amp; 内核编译 - 简略"></a>树莓派源码分析 &amp; 内核编译 - 简略</h1><h3 id="Linux内核源代码目录树结构"><a href="#Linux内核源代码目录树结构" class="headerlink" title="Linux内核源代码目录树结构"></a>Linux内核源代码目录树结构</h3><p><strong>arch：</strong>包含和硬件体系结构相关的代码，每种平台占一个相应的目录。和32位PC相关的代码存放在i386目录下，其中比较重要的包括kernel（内核核心部分）、mm（内存管理）、math-emu（浮点单元仿真）、lib（硬件相关工具函数）、boot（引导程序）、pci（PCI总线）和power（CPU相关状态）。</p>
<p><strong>block：</strong>部分块设备驱动程序。</p>
<p><strong>crypto：</strong>常用加密和散列算法（如AES、SHA等），还有一些压缩和CRC校验算法。</p>
<p><strong>Documentation：</strong>关于内核各部分的通用解释和注释。</p>
<p><strong>drivers：</strong>设备驱动程序，每个不同的驱动占用一个子目录。</p>
<p><strong>fs：</strong>各种支持的文件系统，如ext、fat、ntfs等。</p>
<p><strong>include：</strong>头文件。其中，和系统相关的头文件被放置在linux子目录下。</p>
<p><strong>init：</strong>内核初始化代码（注意不是系统引导代码）。</p>
<p><strong>ipc：</strong>进程间通信的代码。</p>
<p><strong>kernel：</strong>内核的最核心部分，包括进程调度、定时器等，和平台相关的一部分代码放在arch&#x2F;*&#x2F;kernel目录下。</p>
<p><strong>lib：</strong>库文件代码。</p>
<p><strong>mm：</strong>内存管理代码，和平台相关的一部分代码放在arch&#x2F;*&#x2F;mm目录下。</p>
<p><strong>net：</strong>网络相关代码，实现了各种常见的网络协议。</p>
<p><strong>scripts：</strong>用于配置内核文件的脚本文件。</p>
<p><strong>security：</strong>主要是一个SELinux的模块。</p>
<p><strong>sound：</strong>常用音频设备的驱动程序等。</p>
<p><strong>usr：</strong>实现了一个cpio。</p>
<p>在i386体系下，系统引导将从<code>arch/i386/kernel/head.s</code>开始执行，并进而转移到<code>init/main.c</code>中的<code>main()函数</code>初始化内核。</p>
<h3 id="树莓派Linux源码配置"><a href="#树莓派Linux源码配置" class="headerlink" title="树莓派Linux源码配置"></a>树莓派Linux源码配置</h3><p><strong><code>.config</code>文件是linux内核配置文件，当执行#make uImage编译生成内核时，顶层的Makefile会读取<code>.config</code>文件的内容，根据这个配置文件来编译所定制的内核。</strong></p>
<p>内核源码配置的三种方式</p>
<ol>
<li>根据厂家提供的Linux内核源码，进行修改，<code>厂家.config</code>-&gt;<code>自己.config</code></li>
<li><code>make menuconfig</code> 进行配置，通常是基于厂家的config来配置。</li>
<li>完全自己开发</li>
</ol>
<h3 id="内核编译-详细过程参考下一章"><a href="#内核编译-详细过程参考下一章" class="headerlink" title="内核编译 - 详细过程参考下一章"></a>内核编译 - 详细过程参考下一章</h3><p><strong>1.编译内核</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- KERNEL=kernel7 make -j4 zImage modules dtbs</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>-j4</code> 指定用多少电脑资源进行编译</p>
<p><code>zImage</code> 生成内核镜像</p>
<p><code>modules</code> 要生成驱动模块</p>
<p><code>dtbs</code> 生成配置文件（设备树）</p>
</blockquote>
<p><strong>2.编译成功后</strong></p>
<p>看到源码树目录多了vmlinux，失败则无此文件，成功后，目标zImage镜像arch&#x2F;arm&#x2F;boot底下。</p>
<p><strong>3.打包zImage成树莓派可用的xxx.img</strong></p>
<p>直接用linux源码包里的工具：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./scripts/mkknlimg arch/arm/boot/zImage ./kernel_new.img</span><br></pre></td></tr></table></figure>

<p><strong>4.数据拷贝</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir data1 data2</span><br></pre></td></tr></table></figure>

<p>挂载U盘</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mount /dev/sdb1 data1  一个fat分区，是boot相关的内容，kernel的img</span><br><span class="line">sudo mount /dev/sdb2 data2  一个是ext4分区，也就是系统的根目录分区。</span><br></pre></td></tr></table></figure>

<p>安装modules, 设备驱动文件，如 hdmi usb wifi io …</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- KERNEL=kernel7 make INSTALL_MOD_PATH=/home/chenlc/data2 modules_install</span><br></pre></td></tr></table></figure>

<p>安装更新 kernel.img 文件，注意镜像名字是kernel7.img</p>
<p>再把编译新生成的拷贝到data1，起名kernel7.img</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp kernel_new.img /home/chenlc/data1/kernel7.img</span><br></pre></td></tr></table></figure>

<p>拷贝配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp arch/arm/boot/dts/.*dtb* /home/chenlc/data1</span><br></pre></td></tr></table></figure>

<p>后面步骤参考下一章</p>
<blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../../../images/6a13d650389171ea0e9f2e726c339f0f-5095752-1748585374057-4" alt="img"></p>
</blockquote>
<h1 id="树莓派交叉编译-本地编译-详细"><a href="#树莓派交叉编译-本地编译-详细" class="headerlink" title="树莓派交叉编译 &amp; 本地编译 - 详细"></a>树莓派交叉编译 &amp; 本地编译 - 详细</h1><h3 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h3><p>树莓派的github主页：<a target="_blank" rel="noopener" href="https://github.com/raspberrypi%EF%BC%8C%E9%87%8C%E9%9D%A2%E5%8C%85%E5%90%AB%E4%BA%86linux%E6%BA%90%E7%A0%81%E3%80%81%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E5%B7%A5%E5%85%B7%E9%93%BE%E7%AD%89%E5%86%85%E5%AE%B9%E3%80%82">https://github.com/raspberrypi，里面包含了linux源码、交叉编译工具链等内容。</a></p>
<p>对于我们要用到的有两个仓库：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/raspberrypi/linux">https://github.com/raspberrypi/linux</a> 内核源码</p>
<p><a target="_blank" rel="noopener" href="https://github.com/raspberrypi/tools">https://github.com/raspberrypi/tools</a> 交叉编译工具链（仅在交叉编译时用到）</p>
<p>注：<br>1、树莓派里安装的系统镜像版本要和kernel代码对应。因为树莓派系统是在不断开发和升级的，如果你的树莓派使用的是某个时间的系统镜像，那么最好也使用当时的kernel代码。<br>2、关于内核编译方法，官网有很详细的介绍：<a target="_blank" rel="noopener" href="https://www.raspberrypi.org/documentation/linux/kernel/building.md%EF%BC%8C%E8%BF%99%E9%87%8C%E7%AE%97%E6%98%AF%E7%BF%BB%E8%AF%91%E5%92%8C%E8%A1%A5%E5%85%85%E3%80%82">https://www.raspberrypi.org/documentation/linux/kernel/building.md，这里算是翻译和补充。</a><br>3、以下编译过程在树莓派1和树莓派3B上测试ok。</p>
<h3 id="二、ubuntu里交叉编译"><a href="#二、ubuntu里交叉编译" class="headerlink" title="二、ubuntu里交叉编译"></a>二、ubuntu里交叉编译</h3><h4 id="1、获取交叉编译工具和源码"><a href="#1、获取交叉编译工具和源码" class="headerlink" title="1、获取交叉编译工具和源码"></a>1、获取交叉编译工具和源码</h4><p>源码：<strong>git clone <a href="mailto:&#x67;&#105;&#x74;&#x40;&#x67;&#105;&#x74;&#x68;&#117;&#98;&#x2e;&#x63;&#x6f;&#x6d;">&#x67;&#105;&#x74;&#x40;&#x67;&#105;&#x74;&#x68;&#117;&#98;&#x2e;&#x63;&#x6f;&#x6d;</a>:raspberrypi&#x2F;linux</strong></p>
<p>交叉编译工具：<strong>git clone <a href="mailto:&#x67;&#105;&#x74;&#x40;&#103;&#105;&#116;&#x68;&#117;&#x62;&#46;&#99;&#111;&#x6d;">&#x67;&#105;&#x74;&#x40;&#103;&#105;&#116;&#x68;&#117;&#x62;&#46;&#99;&#111;&#x6d;</a>:raspberrypi&#x2F;tools</strong></p>
<h4 id="2、配置编译环境变量"><a href="#2、配置编译环境变量" class="headerlink" title="2、配置编译环境变量"></a>2、配置编译环境变量</h4><h5 id="2-1-手动配置环境变量"><a href="#2-1-手动配置环境变量" class="headerlink" title="2.1 手动配置环境变量"></a>2.1 手动配置环境变量</h5><p>编译工具下载后，在64位ubuntu上编译我们需要的编译工具bin文件在：<code>tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin</code> 目录下，将此目录添加到环境变量PATH中，添加方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PATH=$PATH:/home/nicek/githubProjects/raspberrypi/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin</span><br></pre></td></tr></table></figure>

<p>如果是在32位系统中编译则要选择32位的交叉编译工具。</p>
<p>配置完成之后可以用编译工具命令查看到版本号：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arm-linux-gnueabihf-gcc -v</span><br></pre></td></tr></table></figure>

<p>之后，所有的make命令都要指明一些环境变量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- KERNEL=kernel7</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>ARCH&#x3D;arm</th>
<th>指明当前要编译arm，虽然树莓派是64位的，这里仍然选择arm，而不是arm64。</th>
</tr>
</thead>
<tbody><tr>
<td>CROSS_COMPILE</td>
<td>指明交叉工具链名称。</td>
</tr>
<tr>
<td>KERNEL</td>
<td>指明kernel类型，<strong>树莓派1设置为kernel，树莓派2、3设置为kernel7。</strong></td>
</tr>
</tbody></table>
<p>每次make都需要指明这些环境变量，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- KERNEL=kernel7 make menuconfig</span><br><span class="line">ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- KERNEL=kernel7 make -j4 zImage</span><br></pre></td></tr></table></figure>

<h5 id="2-2-自动配置环境变量"><a href="#2-2-自动配置环境变量" class="headerlink" title="2.2 自动配置环境变量"></a>2.2 自动配置环境变量</h5><p>上面这些环境变量每次命令都要写很麻烦，可以通过export一次设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$PATH:/home/nicek/githubProjects/raspberrypi/tools/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- KERNEL=kernel7</span><br></pre></td></tr></table></figure>

<p>之后在本终端里执行的所有命令都带有这些环境变量信息。</p>
<p>此 export 命令可以写成一个脚本，然后在编译前在终端里source一下这个脚本即可设置好所有的环境变量。就像android编译前也要先source一下envsetup.sh一样。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash DIR=&quot;$( cd &quot;$( dirname &quot;$&#123;BASH_SOURCE[0]&#125;&quot; )&quot; &amp;&amp; pwd )&quot; export PATH=&quot;$PATH:$DIR/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian-x64/bin/&quot; export ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- KERNEL=kernel7 </span><br></pre></td></tr></table></figure>

<p>上述命令中的路径可能和你实际不同，注意修改。</p>
<p>export环境变量后，在本终端里的后续命令都可以不用再指明这些环境变量，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">配置之前的命令：</span><br><span class="line">ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- KERNEL=kernel7 make menuconfig</span><br><span class="line">配置之后的命令：</span><br><span class="line">make menuconfig</span><br></pre></td></tr></table></figure>

<h4 id="3、配置config"><a href="#3、配置config" class="headerlink" title="3、配置config"></a>3、配置config</h4><p>linux源码中有很多工程：<br>树莓派1的工程是<strong>bcmrpi_defconfig</strong><br>树莓派2、3的工程是<strong>bcm2709_defconfig</strong></p>
<h5 id="3-1-使用源码里自带的config"><a href="#3-1-使用源码里自带的config" class="headerlink" title="3.1 使用源码里自带的config"></a>3.1 使用源码里自带的config</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- KERNEL=kernel7 make bcm2709_defconfig</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>ARCH=ARM</code> 指定ARM架构</p>
<p><code>CROSS_COMPILE=arm-linux-gnueabihf-</code> 指定编译器</p>
<p><code>KERNEL=kernel7</code> 树莓派</p>
<p><code>make bcm2709_defconfig</code> 主要核心指令</p>
</blockquote>
<p>此命令功能是获取bcm2709_defconfig的配置到 .config里。<br>我们可以直接用工程里的配置，但这样的话可能会丢失原来使用的树莓派的配置，这里提供一个方法可以获取当前正在使用的树莓派的config。</p>
<h5 id="3-2-获取当前树莓派的config"><a href="#3-2-获取当前树莓派的config" class="headerlink" title="3.2 获取当前树莓派的config"></a>3.2 获取当前树莓派的config</h5><p>已经开机的树莓派上会有这个节点：**&#x2F;proc&#x2F;config.gz<strong>，从这个节点可以获取本树莓派的config。<br>如果没有这个节点的话则需要先加载模块：</strong>sudo modprobe configs**</p>
<p>把 config.gz 内容复制到要编译的电脑上：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp pi@[ip]:/proc/config.gz .</span><br></pre></td></tr></table></figure>

<p>解压，保存为.confg文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zcat config.gz &gt; .config</span><br></pre></td></tr></table></figure>

<p>注：必须在linux环境下解压，在mac下会乱码。</p>
<p>把此config文件复制到linux源码的根目录。</p>
<h4 id="4、编译"><a href="#4、编译" class="headerlink" title="4、编译"></a>4、编译</h4><p>安装必要的库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install bc</span><br><span class="line">sudo apt-get install libncurses5-dev libncursesw5-dev</span><br><span class="line">sudo apt-get install zlib1g:i386</span><br><span class="line">sudo apt-get install libc6-i386 lib32stdc++6 lib32gcc1 lib32ncurses5</span><br></pre></td></tr></table></figure>

<p><strong>4.1 执行menuconfig</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- KERNEL=kernel7 make menuconfig</span><br></pre></td></tr></table></figure>

<p>如果没什么改的就不用执行这一步。</p>
<p><strong>4.2 编译</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- KERNEL=kernel7 make -j4 zImage modules dtbs 2&gt;&amp;1 | tee build.log</span><br></pre></td></tr></table></figure>

<p>以n进程编译。不指明几进程的话则默认以单进程编译。</p>
<p><strong>4.3 打包zImage文件</strong></p>
<p>直接用linux源码包里的工具：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./scripts/mkknlimg arch/arm/boot/zImage ./kernel_new.img</span><br></pre></td></tr></table></figure>

<p>在本目录生成一个kernel_new.img文件，这个文件就是要放到sd卡中的文件。<br>注：网上很多地方说的用 tools&#x2F;mkimage&#x2F;imagetool-uncompressd.py 的方法不行！！</p>
<h4 id="5、挂载树莓派sd卡，并安装编译出的DIRECTLY-到sd卡"><a href="#5、挂载树莓派sd卡，并安装编译出的DIRECTLY-到sd卡" class="headerlink" title="5、挂载树莓派sd卡，并安装编译出的DIRECTLY 到sd卡"></a>5、挂载树莓派sd卡，并安装编译出的DIRECTLY 到sd卡</h4><p>把树莓派的sd卡插入ubuntu系统电脑，树莓派的sd卡有两个分区：<br>一个fat分区，是boot相关的内容，kernel的img文件就放在这个分区里；<br>一个是ext4分区，也就是系统的根目录分区。</p>
<p>我们生成的文件涉及到这两个分区的内容，一般插入ubuntu后会自动挂载，fat分区可以不用root权限操作，ext4分区需要root权限操作。<br>两个分区具体挂载在什么地方可以自己决定，以下用[fat]表示boot挂载的路径，[ext4]表示ext4挂载的路径。</p>
<p><strong>5.1 安装modules</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- KERNEL=kernel7 make INSTALL_MOD_PATH=[ext4] modules_install</span><br></pre></td></tr></table></figure>

<p>操作ext4分区，需要root权限。</p>
<p><strong>5.2 更新 kernel.img 文件</strong><br>前面已经用 mkknlimg 工具打包了kernel_new.img文件了，把它复制到boot分区并配置使用即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp kernel_new.img [fat]/</span><br></pre></td></tr></table></figure>

<p>编辑 [fat]&#x2F;config.txt 文件，在最后加入一行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kernel=kernel_new.img</span><br></pre></td></tr></table></figure>

<p><strong>5.3 复制其他相关文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp arch/arm/boot/dts/*.dtb [fat]/</span><br><span class="line">cp arch/arm/boot/dts/overlays/*.dtb* [fat]/overlays/</span><br><span class="line">cp arch/arm/boot/dts/overlays/README [fat]/overlays/</span><br></pre></td></tr></table></figure>

<p>更新完成后插回树莓派即可开机，开机后可以用 uname -a 命令查看kernel信息已经改变。</p>
<h3 id="三、树莓派本地编译"><a href="#三、树莓派本地编译" class="headerlink" title="三、树莓派本地编译"></a>三、树莓派本地编译</h3><p>树莓派上本地编译和上面交叉编译原理基本相同，由于是本地编译，在编译工具和环境变量配置方面还简单一些。<br>树莓派上编一次内核花了将近2小时。</p>
<h4 id="1、获取源码"><a href="#1、获取源码" class="headerlink" title="1、获取源码"></a>1、获取源码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:raspberrypi/linux</span><br></pre></td></tr></table></figure>

<h4 id="2、配置编译环境"><a href="#2、配置编译环境" class="headerlink" title="2、配置编译环境"></a>2、配置编译环境</h4><p>在ubuntu里交叉编译时需要配置的环境变量有：</p>
<ul>
<li>PATH: 添加交叉工具链的目录</li>
<li>ARCH: 配置成arm</li>
<li>CROSS_COMPILE: 配置成ubuntu上使用的交叉工具链arm-linux-gnueabihf- KERNEL&#x3D;kernel7</li>
<li>KERNEL: 配置成kernel7</li>
</ul>
<p>而在树莓派本地编译：<br>关于交叉工具链，本身的编译工具就可以编译给自己使用，所以不用配置；<br>只需要配置 KERNEL&#x3D;kernel7 即可。</p>
<p>和上面相同，可以用 export KERNEL&#x3D;kernel7，一次设置之后此终端里所有命令都带有此环境变量。<br>也可以更进一步写成脚本，不过这里这一行命令很简单，不写脚本也可以。</p>
<h4 id="3、配置config-1"><a href="#3、配置config-1" class="headerlink" title="3、配置config"></a>3、配置config</h4><p>和上面一样，<br>树莓派1使用的是 <strong>bcmrpi_defconfig</strong>，<br>树莓派2、3使用的是 <strong>bcm2709_defconfig</strong>。<br>例：KERNEL&#x3D;kernel7 make bcm2709_defconfig</p>
<p>如果要使用树莓派自带的config的话：<br><strong>sudo modprobe configs</strong> # 加载模块<br><strong>zcat config.gz &gt; .config</strong> # 获取配置</p>
<h4 id="4、编译-1"><a href="#4、编译-1" class="headerlink" title="4、编译"></a>4、编译</h4><p>安装必要的库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install bc</span><br><span class="line">sudo apt-get install libncurses5-dev libncursesw5-dev</span><br><span class="line">sudo apt-get install zlib1g</span><br><span class="line">sudo apt-get install libc6</span><br></pre></td></tr></table></figure>

<p>1、执行menuconfig<br><strong>KERNEL&#x3D;kernel7 make menuconfig</strong><br>没什么要改的话就不用执行这一步。</p>
<p>2、编译<br><strong>KERNEL&#x3D;kernel7 make -j4 zImage modules dtbs 2&gt;&amp;1 | tee build.log</strong><br>以n进程编译。不指明几进程的话则默认以单进程编译。</p>
<p>3、打包zImage文件<br>直接用linux源码包里的工具：<br><strong>.&#x2F;scripts&#x2F;mkknlimg arch&#x2F;arm&#x2F;boot&#x2F;zImage .&#x2F;kernel_new.img</strong><br>在本目录生成一个kernel_new.img文件，这个文件就是要放到sd卡中的文件。</p>
<h4 id="5、更新系统"><a href="#5、更新系统" class="headerlink" title="5、更新系统"></a>5、更新系统</h4><p>1、安装模块<br><strong>sudo make modules_install</strong></p>
<p>2、复制dtb文件<br><strong>sudo cp arch&#x2F;arm&#x2F;boot&#x2F;dts&#x2F;*.dtb &#x2F;boot&#x2F; sudo cp arch&#x2F;arm&#x2F;boot&#x2F;dts&#x2F;overlays&#x2F;*.dtb* &#x2F;boot&#x2F;overlays&#x2F; sudo cp arch&#x2F;arm&#x2F;boot&#x2F;dts&#x2F;overlays&#x2F;README &#x2F;boot&#x2F;overlays&#x2F;</strong></p>
<p>3、更新kernel.img文件<br><strong>sudo cp arch&#x2F;arm&#x2F;boot&#x2F;zImage &#x2F;boot&#x2F;$KERNEL.img</strong></p>
<h1 id="树莓派Linux内核编译-编程那些年"><a href="#树莓派Linux内核编译-编程那些年" class="headerlink" title="树莓派Linux内核编译 - 编程那些年"></a>树莓派Linux内核编译 - 编程那些年</h1><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzkzMDE4MDM2NQ==&mid=2247483946&idx=1&sn=c896dceca1b41e69705d0f5d1e439838&scene=19#wechat_redirect">编程那些年 - 文章</a></p>
<p>树莓派的Linux内核编译有两种方法: 一种是在树莓派上直接编译，另一种是利用交叉编译的方法。一般我们都推荐采用交叉编译的方式进行编译，这是因为通常交叉编译Pi内核的速度比Pi本身编译快得多（性能因素）。下面就讲下如下利用这两种方式来编译Pi内核。 </p>
<h3 id="第一种方法：Pi本地编译"><a href="#第一种方法：Pi本地编译" class="headerlink" title="第一种方法：Pi本地编译"></a>第一种方法：Pi本地编译</h3><p><strong>前提条件</strong></p>
<p>准备一张16G以上TF卡。</p>
<p>如果上述没有该条件，可以利用NFS挂载方式，将源码目录挂载到主机上，利用主机的空间来存储代码，但会影响到编译速度。 比如我将虚拟机的nfs目录挂载到Pi的&#x2F;mnt目录下，并在该目录下存储代码，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:~ $ mount | grep mnt</span><br><span class="line">192.168.1.133:/nfs/ on /mnt type nfs (rw,relatime,vers=3,rsize=524288,wsize=524288,namlen=255,hard,nolock,proto=tcp,port=2049,timeo=70,retrans=3,sec=sys,local_lock=all,addr=192.168.1.133)</span><br><span class="line">pi@raspberrypi:~ $ ls /mnt/</span><br><span class="line">linux</span><br><span class="line">pi@raspberrypi:~ $</span><br></pre></td></tr></table></figure>

<p><strong>编译前准备</strong></p>
<p>​    首先，配置好树莓派的网络<em>（用推荐用有线网络，否则下载会非常慢）</em>和树莓派的源（推荐使用阿里源，将<strong>“raspbian.raspberrypi.org”</strong>替换为<strong>“mirrors.aliyun.com&#x2F;raspbian”</strong>字段），正常souces.list前后替换后差异内容大致如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/./../../../images/640-1748585374057-5.png" alt="图片"></p>
<p>  安装git和树莓派内核编译所需的依赖库，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install git bc bison flex libssl-dev make</span><br></pre></td></tr></table></figure>

<p><strong>下载内核源码</strong></p>
<p>   利用git获取当前git仓库默认Pi的内核源码，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone --depth=1 https://github.com/raspberrypi/linux</span><br></pre></td></tr></table></figure>

<p>  当然，你也可以选择下载自己所需的内核源码版本，如需要下载4.14.y，可利用branch参数下载，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone --depth=1 https://github.com/raspberrypi/linux --branch rpi-4.14.y</span><br></pre></td></tr></table></figure>

<p><strong>配置内核</strong></p>
<p>根据当前你使用的Raspberry Pi的实际型号，通过运行以下具体命令进行准备默认配置：</p>
<p>​    如果是Raspberry Pi 2, Pi 3, Pi 3+系列，默认配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:/mnt $ cd linux</span><br><span class="line">pi@raspberrypi:/mnt/linux $ KERNEL=kernel7</span><br><span class="line">pi@raspberrypi:/mnt/linux $ make bcm2709_defconfig</span><br></pre></td></tr></table></figure>

<p>Raspberry Pi 4的默认配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:/mnt $ cd linux</span><br><span class="line">pi@raspberrypi:/mnt/linux $ KERNEL=kernel7l</span><br><span class="line">pi@raspberrypi:/mnt/linux $ make bcm2711_defconfig</span><br></pre></td></tr></table></figure>

<p>Raspberry Pi 1、Pi Zero、Pi Zero W系列的默认采用配置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:/mnt $ cd linux</span><br><span class="line">pi@raspberrypi:/mnt/linux $ KERNEL=kernel</span><br><span class="line">pi@raspberrypi:/mnt/linux $ make bcmrpi_defconfig</span><br></pre></td></tr></table></figure>

<p>​    如果需要额外对内核进行配置，则可以利用如下命令实现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:/mnt/linux $ make menuconfig</span><br></pre></td></tr></table></figure>

<p> <strong>编译和安装</strong></p>
<p>​    最后进行编译安装内核、驱动模块、设备树配置操作，这个过程会比较漫长，需要耐心等待，命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:/mnt/linux $ make -j4 zImage modules dtbs</span><br><span class="line">pi@raspberrypi:/mnt/linux $ sudo make modules_install</span><br><span class="line">pi@raspberrypi:/mnt/linux $ sudo cp arch/arm/boot/dts/*.dtb /boot/</span><br><span class="line">pi@raspberrypi:/mnt/linux $ sudo cp arch/arm/boot/dts/overlays/*.dtb* /boot/overlays/</span><br><span class="line">pi@raspberrypi:/mnt/linux $ sudo cp arch/arm/boot/dts/overlays/README /boot/overlays/</span><br><span class="line">pi@raspberrypi:/mnt/linux $ sudo cp arch/arm/boot/zImage /boot/$KERNEL.img</span><br><span class="line">pi@raspberrypi:/mnt/linux $  sudo reboot -f</span><br></pre></td></tr></table></figure>

<h3 id="第二种方法：交叉编译内核"><a href="#第二种方法：交叉编译内核" class="headerlink" title="第二种方法：交叉编译内核"></a>第二种方法：交叉编译内核</h3><p>首先，需要准备一台Linux交叉编译主机，比如Ubuntu 18.04（可以安装实体机或者VMware或VirtualBox里）。</p>
<p><strong>编译前准备</strong><br>首先在交叉编译Linux主机上安装所需的依赖和交叉编译工具，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install git bc bison flex libssl-dev make libc6-dev libncurses5-dev</span><br></pre></td></tr></table></figure>

<p>如果Pi安装的是32的内核，则安装32位的交叉编译工具链：</p>
<p>（注：通过在Pi里运行<strong>“file &#x2F;sbin&#x2F;busybox”</strong> 或其他可执行程序可查看当前内核是32位还是64位的。如果是32位的，会显示如下32-bit 字段，否则为64位的）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install crossbuild-essential-armhf</span><br></pre></td></tr></table></figure>

<p>否则，如果Pi使用的是64的内核，则安装64位的交叉编译工具链：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install crossbuild-essential-arm64</span><br></pre></td></tr></table></figure>

<p><strong>获取源码</strong></p>
<p> 利用git获取当前git仓库默认Pi的内核源码，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone --depth=1 https://github.com/raspberrypi/linux</span><br></pre></td></tr></table></figure>

<p>  当然，你也可以选择下载自己所需的内核源码版本，如需要下载4.14.y，可利用branch参数下载，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone --depth=1 https://github.com/raspberrypi/linux --branch rpi-4.14.y</span><br></pre></td></tr></table></figure>

<p><strong>配置内核</strong></p>
<p><strong>针对32位系统:</strong></p>
<p>如果是Pi 2, Pi 3, Pi 3+, 和3系列树莓派，运行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">linux@ubuntu:~$ cd linux</span><br><span class="line">linux@ubuntu:~/linux$ KERNEL=kernel7</span><br><span class="line">linux@ubuntu:~/linux$ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- bcm2709_defconfig</span><br></pre></td></tr></table></figure>

<p>如果是Raspberry Pi 4，运行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">linux@ubuntu:~$ cd linux</span><br><span class="line">linux@ubuntu:~/linux$ KERNEL=kernel7l</span><br><span class="line">linux@ubuntu:~/linux$ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- bcm2711_defconfig</span><br></pre></td></tr></table></figure>

<p>如果是Pi 1, Pi Zero, Pi Zero W，运行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">linux@ubuntu:~$ cd linux</span><br><span class="line">linux@ubuntu:~/linux$ KERNEL=kernel</span><br><span class="line">linux@ubuntu:~/linux$ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- bcmrpi_defconfig</span><br></pre></td></tr></table></figure>

<p><strong>针对64位系统：</strong></p>
<p>  如果是Pi 2, Pi 3, Pi 3+, 和3系列树莓派，运行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">linux@ubuntu:~$ cd linux</span><br><span class="line">linux@ubuntu:~/linux$ KERNEL=kernel8</span><br><span class="line">linux@ubuntu:~/linux$ make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- bcmrpi3_defconfig</span><br></pre></td></tr></table></figure>

<p>如果是Raspberry Pi 4，运行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">linux@ubuntu:~$ cd linux</span><br><span class="line">linux@ubuntu:~/linux$ KERNEL=kernel8</span><br><span class="line">linux@ubuntu:~/linux$ make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- bcm2711_defconfig</span><br></pre></td></tr></table></figure>

<p><strong>编译内核</strong></p>
<p>如果是32位内核，运行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -j4  ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- zImage modules dtbs</span><br></pre></td></tr></table></figure>

<p>如果是64位内核，运行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -j4  ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- Image modules dtbs</span><br></pre></td></tr></table></figure>

<p><strong>内核安装到TF卡</strong></p>
<p>将TF卡接到Linux交叉编译主机上（如果是VMwar虚拟机，则需要将”设置-&gt;硬件-&gt;USB控制机-&gt;USB兼容性(C)”调成“USB 1.1”）</p>
<p>运行<strong>lsblk</strong>命令查看识别到的TF卡设备节点，如下：*</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">linux@ubuntu:~/linux$ lsblk</span><br><span class="line">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda      8:0    0   20G  0 disk </span><br><span class="line">└─sda1   8:1    0   20G  0 part /</span><br><span class="line">sdb      8:16   1 14.6G  0 disk </span><br><span class="line">├─sdb1   8:17   1  256M  0 part /media/linux/boot</span><br><span class="line">└─sdb2   8:18   1  3.3G  0 part /media/linux/rootfs</span><br></pre></td></tr></table></figure>

<p>正常TF卡设备会自动挂载到&#x2F;media&#x2F;${当前用户目录}&#x2F;下的boot和rootfs目录下，如果没有自动挂载，则根据识别到实际TF卡的设备节点，将设备挂载到主机上，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /media/linux/rootfs -p</span><br><span class="line">sudo mkdir /media/linux/boot -p</span><br><span class="line">sudo mount /dev/sdb1 /media/linux/boot</span><br><span class="line">sudo mount /dev/sdb2 /media/linux/rootfs</span><br></pre></td></tr></table></figure>

<p>​    然后将内核模块安装到SD中：</p>
<p>  如果是32位内核，运行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo env PATH=$PATH make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- INSTALL_MOD_PATH=/media/linux/rootfs modules_install</span><br></pre></td></tr></table></figure>

<p>如果是64位内核，运行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo env PATH=$PATH make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- INSTALL_MOD_PATH=/media/linux/rootfs modules_install</span><br></pre></td></tr></table></figure>

<p>最后备份原理SD卡中的旧内核， 并将新内核和设备树配置文件到SD卡中:</p>
<p>如果是32位内核，运行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /media/linux/boot/$KERNEL.img /media/linux/boot/$KERNEL-backup.img</span><br><span class="line">sudo cp arch/arm/boot/zImage /media/linux/boot/$KERNEL.img</span><br><span class="line">sudo cp arch/arm/boot/dts/*.dtb /media/linux/boot</span><br><span class="line">sudo cp arch/arm/boot/dts/overlays/*.dtb* /media/linux/boot/overlays/</span><br><span class="line">sudo cp arch/arm/boot/dts/overlays/README /media/linux/boot/overlays/</span><br><span class="line">sudo umount /media/linux/boot</span><br><span class="line">sudo umount /media/linux/rootfs</span><br></pre></td></tr></table></figure>

<p>如果是64位内核，运行如下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo</span><br><span class="line">cp /media/linux/boot/$KERNEL.img /media/linux/boot/$KERNEL-backup.img</span><br><span class="line">sudo cp arch/arm64/boot/Image /media/linux/boot/$KERNEL.img</span><br><span class="line">sudo cp arch/arm64/boot/dts/broadcom/*.dtb /media/linux/boot/</span><br><span class="line">sudo cp arch/arm64/boot/dts/overlays/*.dtb* /media/linux/boot/overlays/</span><br><span class="line">sudo cp arch/arm64/boot/dts/overlays/README /media/linux/boot/overlays/</span><br><span class="line">sudo umount /media/linux/boot/</span><br><span class="line">sudo umount /media/linux/rootfs</span><br></pre></td></tr></table></figure>

<p>当然，你也可以不备份旧的内核，而是通过重命令编译出来的内核名称，如将编译出来的img改为kernel-new.img，然后修改config.txt的配置文件种的kernel字段,如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kernel=kernel-new.img</span><br></pre></td></tr></table></figure>

<p>这么做的好处是保证原有的内核不被破坏，如果新的内核无法启动，只需要将config.txt的kernel字段改回来即可。</p>
<p>最后，将TF卡插回Pi上，然后启动Pi即可。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://www.linqiutianovo.xyz">LinQiuTian</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://www.linqiutianovo.xyz/2022/01/01/test/%E6%A0%91%E8%8E%93%E6%B4%BE/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E4%B8%8E%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/">https://www.linqiutianovo.xyz/2022/01/01/test/%E6%A0%91%E8%8E%93%E6%B4%BE/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E4%B8%8E%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://www.linqiutianovo.xyz" target="_blank">林秋天的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/">树莓派</a><a class="post-meta__tags" href="/tags/%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91/">交叉编译</a><a class="post-meta__tags" href="/tags/%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91/">内核编译</a><a class="post-meta__tags" href="/tags/Linux%E5%BC%80%E5%8F%91/">Linux开发</a><a class="post-meta__tags" href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/">嵌入式</a></div><div class="post-share"><div class="social-share" data-image="/img/default-cover3.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2022/01/01/test/%E6%A0%91%E8%8E%93%E6%B4%BE/%E9%9D%99%E6%80%81%E5%BA%93%E4%B8%8E%E5%8A%A8%E6%80%81%E5%BA%93/" title="静态库与动态库详解"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-cover2.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">静态库与动态库详解</div></div><div class="info-2"><div class="info-item-1">静态库与动态库 - HQ[TOC]  注意 参考文章1 - 未摘录 参考文章2 - 未摘录   库的制作静态库的制作格式  xxxx.a  gcc calcufuncs.c -c 生成xxx.o文件 ar rcs libcalcufunc.a calcufuncs.o xxx.o文件生成xxx.a静态库文件  动态库的制作格式  xxxx.so gcc -shared -fpic calcufuncs.c -o libcalc.so  -shared 指定生成动态库 -fpic 标准，fPIC 选项作用于编译阶段,在生成目标文件时就得使用该选项,以生成位置无关的代码。  库的使用静态库使用gcc calculatorT.c -lcalcufunc -L ./ -o mainProStatic   -lcalcufunc -l（小写l）是指定要用的动态库，库名砍头去尾，只要用中间的名字 -L告诉gcc编译器从-L指定的路径去找静态库，默认是从&#x2F;usr&#x2F;lib &#x2F;usr&#x2F;local&#x2F;lib去找  动态库使用gcc...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2022/05/05/test/%E6%A0%91%E8%8E%93%E6%B4%BE/%E6%A0%91%E8%8E%93%E6%B4%BE%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%20/" title="树莓派配置使用教程"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-05</div><div class="info-item-2">树莓派配置使用教程</div></div><div class="info-2"><div class="info-item-1">树莓派配置使用教程 - HQ[TOC]  注意 树莓派使用文章汇总 - 编程那些年 - 已摘录 Linux基础文章汇总 - 编程那些年 - 已摘录 超简单教你在树莓派上安装opencv(一) - 未摘录 超简单教你在树莓派上安装opencv(一) - 未摘录   【树莓派】基本使用 &amp; 基本操作打开树莓派Linux系统可视化配置界面  sudo raspi-config    【树莓派】静态IP的正确配置方式(wifi)WiFi模式下使用以下几种方法，可以快速配置静态IP， 不用担心因为路由器DHCP的租约到期导致IP被重新分配的问题，并且会保留配置好的网络环境对应的静态IP，不用每次都来修改配置，非常方便。接下来就讲下几种配置方法。 方法一：直接修改配置文件1、刷完机后首先根据需要，参考公众号文章《【树莓派】配置串口登录》、《【树莓派】系统启用SSH服务》选择性的做相应的配置2、根据《【树莓派】配置无线网络(wifi)》文章连接WIFI，并确认动态获取的IP，通过ifconfig命令查看： 123456789pi@raspberrypi:~ $ ifconfig...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2024/08/07/KfPnTIM8WvotugL.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">LinQiuTian</div><div class="author-info-description">林秋天的博客</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">22</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">31</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/linqiutian"><i></i><span>🛴客官点一点...</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/linqiutian" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="/412581566@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"><center>主域名：<br><a href="https://www.linqiutianovo.xyz"><b><font color="#5ea6e5">https://www.linqiutianovo.xyz/</font></b></a>&nbsp;|&nbsp;<a href="https://www.linqiutianovo.xyz/"><b><font color="#5ea6e5">https://www.linqiutianovo.xyz</font></b></a><br>备用域名：<br><a href="https://www.linqiutianovo.xyz"><b><font color="#5ea6e5">https://www.linqiutianovo.xyz</font></b></a><br><a href="https://www.linqiutianovo.xyz"><b><font color="#5ea6e5">aa.fomal.cc</font></b></a><br><a href="https://www.linqiutianovo.xyz/"><b><font color="#5ea6e5">https://www.linqiutianovo.xyz/</font></b></a><br><a href="mailto:412581566@fqq.com">📬：<b><font color="#a591e0">412581566@fqq.com</font></b></a></center></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91-%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91-HQ"><span class="toc-text">树莓派交叉编译 &amp; 内核编译 - HQ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-text">注意</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91"><span class="toc-text">树莓派交叉编译</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5"><span class="toc-text">引入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E5%B7%A5%E5%85%B7%E9%93%BE%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-text">交叉编译工具链的安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E4%BD%BF%E7%94%A8%E4%B8%BE%E4%BE%8B"><span class="toc-text">交叉编译使用举例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%91%E8%8E%93%E6%B4%BE%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91-%E7%AE%80%E7%95%A5"><span class="toc-text">树莓派源码分析 &amp; 内核编译 - 简略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux%E5%86%85%E6%A0%B8%E6%BA%90%E4%BB%A3%E7%A0%81%E7%9B%AE%E5%BD%95%E6%A0%91%E7%BB%93%E6%9E%84"><span class="toc-text">Linux内核源代码目录树结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%91%E8%8E%93%E6%B4%BELinux%E6%BA%90%E7%A0%81%E9%85%8D%E7%BD%AE"><span class="toc-text">树莓派Linux源码配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91-%E8%AF%A6%E7%BB%86%E8%BF%87%E7%A8%8B%E5%8F%82%E8%80%83%E4%B8%8B%E4%B8%80%E7%AB%A0"><span class="toc-text">内核编译 - 详细过程参考下一章</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91-%E6%9C%AC%E5%9C%B0%E7%BC%96%E8%AF%91-%E8%AF%A6%E7%BB%86"><span class="toc-text">树莓派交叉编译 &amp; 本地编译 - 详细</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0"><span class="toc-text">一、概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81ubuntu%E9%87%8C%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91"><span class="toc-text">二、ubuntu里交叉编译</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E8%8E%B7%E5%8F%96%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E5%B7%A5%E5%85%B7%E5%92%8C%E6%BA%90%E7%A0%81"><span class="toc-text">1、获取交叉编译工具和源码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AE%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-text">2、配置编译环境变量</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-text">2.1 手动配置环境变量</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-text">2.2 自动配置环境变量</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E9%85%8D%E7%BD%AEconfig"><span class="toc-text">3、配置config</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-%E4%BD%BF%E7%94%A8%E6%BA%90%E7%A0%81%E9%87%8C%E8%87%AA%E5%B8%A6%E7%9A%84config"><span class="toc-text">3.1 使用源码里自带的config</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%A0%91%E8%8E%93%E6%B4%BE%E7%9A%84config"><span class="toc-text">3.2 获取当前树莓派的config</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E7%BC%96%E8%AF%91"><span class="toc-text">4、编译</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E6%8C%82%E8%BD%BD%E6%A0%91%E8%8E%93%E6%B4%BEsd%E5%8D%A1%EF%BC%8C%E5%B9%B6%E5%AE%89%E8%A3%85%E7%BC%96%E8%AF%91%E5%87%BA%E7%9A%84DIRECTLY-%E5%88%B0sd%E5%8D%A1"><span class="toc-text">5、挂载树莓派sd卡，并安装编译出的DIRECTLY 到sd卡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%A0%91%E8%8E%93%E6%B4%BE%E6%9C%AC%E5%9C%B0%E7%BC%96%E8%AF%91"><span class="toc-text">三、树莓派本地编译</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E8%8E%B7%E5%8F%96%E6%BA%90%E7%A0%81"><span class="toc-text">1、获取源码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E9%85%8D%E7%BD%AE%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83"><span class="toc-text">2、配置编译环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E9%85%8D%E7%BD%AEconfig-1"><span class="toc-text">3、配置config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E7%BC%96%E8%AF%91-1"><span class="toc-text">4、编译</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E6%9B%B4%E6%96%B0%E7%B3%BB%E7%BB%9F"><span class="toc-text">5、更新系统</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%91%E8%8E%93%E6%B4%BELinux%E5%86%85%E6%A0%B8%E7%BC%96%E8%AF%91-%E7%BC%96%E7%A8%8B%E9%82%A3%E4%BA%9B%E5%B9%B4"><span class="toc-text">树莓派Linux内核编译 - 编程那些年</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E6%B3%95%EF%BC%9APi%E6%9C%AC%E5%9C%B0%E7%BC%96%E8%AF%91"><span class="toc-text">第一种方法：Pi本地编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E6%B3%95%EF%BC%9A%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E5%86%85%E6%A0%B8"><span class="toc-text">第二种方法：交叉编译内核</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2024 - 2025 By LinQiuTian</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.4.0-b1"></script><script src="/js/main.js?v=5.4.0-b1"></script><script src="/js/tw_cn.js?v=5.4.0-b1"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"></div><div class="aplayer" data-id="12551163241" data-server="netease" data-type="playlist"  data-fixed="true" data-theme="#3F51B5"></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/fireworks.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search articles..." type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.4.0-b1"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var qweather_key = '637b20351e874329896d0920eb741c8e';
  var gaud_map_key = '4a866722dcf666eb29a2326ae458eaf1';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '113.34532,23.15624';
  var clock_default_rectangle_enable = 'true';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v6.2.0" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v4.3.1" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" data-title="本站采用多线部署，主线路托管于Vercel" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a><a class="github-badge" target="_blank" href="https://dashboard.4everland.org/" style="margin-inline:5px" data-title="本站采用多线部署，备用线路托管于4EVERLAND" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-4EVERLAND-22DDDD?style=flat&amp;logo=IPFS" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="https://unpkg.zhimg.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.min.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '1s');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '2');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body></html>