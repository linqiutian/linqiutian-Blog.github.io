(function(){"use strict";const o={LCP:null,FID:null,CLS:null,FCP:null,TTFB:null,timestamp:(new Date).toISOString(),url:window.location.href,userAgent:navigator.userAgent};const r={LCP:{good:2500,needsImprovement:4e3},FID:{good:100,needsImprovement:300},CLS:{good:.1,needsImprovement:.25},FCP:{good:1800,needsImprovement:3e3},TTFB:{good:800,needsImprovement:1800}};function i(e,n){const t=r[e];if(!t)return"unknown";if(n<=t.good)return"good";if(n<=t.needsImprovement)return"needs-improvement";return"poor"}function s(e,n){const t=i(e,n);const o=t==="good"?"#0cce6b":t==="needs-improvement"?"#ffa400":"#ff4e42";console.log(`%c[Web Vitals] ${e}: ${n.toFixed(e==="CLS"?3:0)}${e==="CLS"?"":"ms"} (${t})`,`color: ${o}; font-weight: bold;`)}function c(e){if(typeof gtag==="function"){gtag("event",e.name,{event_category:"Web Vitals",event_label:e.rating,value:Math.round(e.name==="CLS"?e.value*1e3:e.value),non_interaction:true})}if(typeof _hmt!=="undefined"&&_hmt.push){_hmt.push(["_trackEvent","Web Vitals",e.name,e.rating,Math.round(e.value)])}}function e(e){}function a(e,n){o[e]=n;const t=i(e,n);s(e,n);c({name:e,value:n,rating:t,timestamp:(new Date).toISOString(),url:window.location.href})}function n(){if(!("PerformanceObserver"in window))return;try{const e=new PerformanceObserver(function(e){const n=e.getEntries();const t=n[n.length-1];if(t){a("LCP",t.startTime)}});e.observe({type:"largest-contentful-paint",buffered:true})}catch(e){console.warn("[Web Vitals] LCP observation not supported")}}function t(){if(!("PerformanceObserver"in window))return;try{const e=new PerformanceObserver(function(e){const n=e.getEntries();n.forEach(function(e){if(e.processingStart&&e.startTime){a("FID",e.processingStart-e.startTime)}})});e.observe({type:"first-input",buffered:true})}catch(e){console.warn("[Web Vitals] FID observation not supported")}}function u(){if(!("PerformanceObserver"in window))return;let n=0;let t=[];try{const e=new PerformanceObserver(function(e){e.getEntries().forEach(function(e){if(!e.hadRecentInput){t.push(e);n+=e.value}})});e.observe({type:"layout-shift",buffered:true});document.addEventListener("visibilitychange",function(){if(document.visibilityState==="hidden"&&n>0){a("CLS",n)}})}catch(e){console.warn("[Web Vitals] CLS observation not supported")}}function f(){if(!("PerformanceObserver"in window))return;try{const t=new PerformanceObserver(function(e){const n=e.getEntries();n.forEach(function(e){if(e.name==="first-contentful-paint"){a("FCP",e.startTime);t.disconnect()}})});t.observe({type:"paint",buffered:true})}catch(e){console.warn("[Web Vitals] FCP observation not supported")}}function m(){try{const e=performance.getEntriesByType("navigation")[0];if(e){const n=e.responseStart-e.requestStart;if(n>0){a("TTFB",n)}}}catch(e){console.warn("[Web Vitals] TTFB measurement not supported")}}function l(){return Object.assign({},o)}function d(){const t={metrics:l(),ratings:{},summary:{good:0,needsImprovement:0,poor:0}};["LCP","FID","CLS","FCP","TTFB"].forEach(function(e){if(o[e]!==null){const n=i(e,o[e]);t.ratings[e]=n;t.summary[n==="needs-improvement"?"needsImprovement":n]++}});return t}function p(){if(!("PerformanceObserver"in window)){console.warn("[Web Vitals] PerformanceObserver not supported");return}if(document.readyState==="complete"){v()}else{window.addEventListener("load",v)}}function v(){setTimeout(function(){n();t();u();f();m();console.log("%c[Web Vitals] 监控已启动","color: #6C7A89; font-weight: bold;")},0)}window.WebVitals={getMetrics:l,generateReport:d};p()})();