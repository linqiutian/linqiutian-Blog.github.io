(function(){"use strict";function e(){return window.innerWidth<=768||/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function n(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}if(e()){console.log("[Universe] 移动设备，星空动画已禁用");return}if(n()){console.log("[Universe] 用户偏好减少动画，星空动画已禁用");return}let t,i,o,r;let a=[];let l=null;let d=true;let c=false;const u=Math.min(50,Math.floor(window.innerWidth*.05));function s(){t=document.getElementById("universe");if(!t){console.warn("[Universe] Canvas 元素未找到");return false}i=t.getContext("2d");if(!i){console.warn("[Universe] 无法获取 2D 上下文");return false}f();return true}function f(){o=window.innerWidth;r=window.innerHeight;t.width=o;t.height=r}function m(){return{x:Math.random()*o,y:Math.random()*r,size:Math.random()*2+.5,speed:Math.random()*.5+.1,opacity:Math.random()*.8+.2,twinkleSpeed:Math.random()*.02+.01}}function h(e){e.x-=e.speed;e.opacity+=Math.sin(Date.now()*e.twinkleSpeed)*.1;if(e.x<0){e.x=o;e.y=Math.random()*r}e.opacity=Math.max(.1,Math.min(1,e.opacity))}function w(e){i.save();i.globalAlpha=e.opacity;i.fillStyle="#ffffff";i.beginPath();i.arc(e.x,e.y,e.size,0,Math.PI*2);i.fill();i.restore()}function g(){return document.documentElement.getAttribute("data-theme")==="dark"}function v(){if(!g()||!d){l=requestAnimationFrame(v);return}i.clearRect(0,0,o,r);for(let e=0;e<a.length;e++){h(a[e]);w(a[e])}l=requestAnimationFrame(v)}function y(){if(l===null){v()}}function M(){if(l!==null){cancelAnimationFrame(l);l=null}}function p(){f();a.forEach(function(e){if(e.x>o){e.x=Math.random()*o}if(e.y>r){e.y=Math.random()*r}})}function E(){d=!document.hidden;if(d){console.log("[Universe] 页面可见，恢复动画")}else{console.log("[Universe] 页面隐藏，暂停动画")}}function U(){if(g()){t.style.display="block"}else{t.style.display="none"}}function x(){if(c)return;if(!s()){return}for(let e=0;e<u;e++){a.push(m())}let e;window.addEventListener("resize",function(){clearTimeout(e);e=setTimeout(p,150)});document.addEventListener("visibilitychange",E);const n=document.querySelector("[data-theme-toggle]");if(n){n.addEventListener("click",function(){setTimeout(U,100)})}const t=window.matchMedia("(prefers-reduced-motion: reduce)");t.addEventListener("change",function(e){if(e.matches){M();console.log("[Universe] 用户启用减少动画偏好，停止动画")}else{y();console.log("[Universe] 用户禁用减少动画偏好，恢复动画")}});U();y();c=true;console.log("[Universe] 星空动画已初始化，星星数量:",u)}function A(){M();a=[];c=false}window.addEventListener("beforeunload",A);if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",x)}else{x()}window.UniverseAnimation={start:y,stop:M,cleanup:A,isRunning:function(){return l!==null}}})();